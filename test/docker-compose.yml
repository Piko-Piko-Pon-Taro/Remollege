version: '3'
services:
    client:
        image: node:12
        ports:
            - ${CLIENT_PORT}:${CLIENT_PORT}
        env_file: .env
        volumes:
            - ../client/:/src/client:cached
        working_dir: /src/client
        tty: true
        command: bash -c 'npm install && npm run dev'
        expose:
            - ${CLIENT_PORT}
        depends_on:
            - api
    api:
        image: node:12
        ports:
            - ${API_PORT}:${API_PORT}
        env_file: .env
        volumes:
            - ../api/:/src/api:cached
        working_dir: /src/api
        tty: true
        command: bash -c 'npm install && npm run dev'
        expose:
            - ${API_PORT}
        depends_on:
            - db
    phpmyadmin:
        image: phpmyadmin/phpmyadmin
        restart: always
        ports:
            - ${PMA_PORT}:80
        depends_on:
            - db
        expose:
            - ${PMA_PORT}
        env_file: .env
    db:
        image: mysql:5.7
        restart: always
        ports:
            - 3306:3306
        env_file: .env
        volumes:
            - ../database/my.cnf:/etc/mysql/conf.d/my.cnf:cached
            - ../database/init:/docker-entrypoint-initdb.d:cached
        expose:
            - 3306
    swagger-editor:
        image: swaggerapi/swagger-editor
        ports:
            - 8081:8080
    swagger-ui:
        image: swaggerapi/swagger-ui
        ports:
            - 8082:8080
        volumes:
            - ../api/swagger.yaml:/swagger.yaml
        environment:
            SWAGGER_JSON: /swagger.yaml
